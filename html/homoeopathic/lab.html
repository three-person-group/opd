<!DOCTYPE html>

<html>

<head>
   <h2>lab</h2>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <link rel="stylesheet" href="bill.lab.css">

   <style>
      select {
         appearance: none;
      }


      #autocomplete {
         width: 250px;
         float: left;
         position: relative;
      }

      .testname {
         width: 100%;
         height: 36px;
         font-size: 18px;
         padding: 3px 10px;
         border-radius: 4px;
         /* border: 1px solid #e58940; */
         outline: 0;
         box-sizing: border-box;
      }

      .list {
         width: 100%;
         position: absolute;
         border: 1px solid #4d6e87;
         display: none;
         background-color: #4d6e87;
      }

      .list ul {
         list-style: none;
         background: #fff;
         margin: 0;
         padding: 0;
         text-align: left;

      }

      .list ul li {
         padding: 2px 10px;
         cursor: pointer;
      }

      .list ul li:hover {
         background: #d0e4f4;
      }
   </style>

<link rel="stylesheet" href="mesicine.css">

</head>

<body>

   <form method="post" action="">

      <button href="" name="add_lab">Add</button>
      <br>

      <div>
         <!-- <label>
            lab Name:
         </label> -->
         <div id="autocomplete">
            <input type="text" name="stestname1" id="id-lab-1" class="testname" placeholder="lab Name"
               autocomplete="false">
            <div id="testlist1" class="list" style="z-index: 1"></div>
         </div>


         <input type="number" placeholder="Qty" id="id-qty-1" class="qty" name="sqty1">


         <input id="id-charges-1" class="ipt-charges" name="scharges1"></input>
         <br>
         <br>

         <br>
         <br><br>

      </div>
      <div>
         <!-- <label>
            lab Name:
         </label> -->
         <div id="autocomplete">
            <input type="text" name="stestname2" id="id-lab-2" class="testname" placeholder="lab Name"
               autocomplete="false">
            <div id="testlist2" class="list" style="z-index: 1"></div>
         </div>


         <input type="number" placeholder="Qty" id="id-qty-2" class="qty" name="sqty2">


         <input id="id-charges-2" class="ipt-charges" name="scharges2"></input>
         <br>
         <br>

      </div>
      <br><br><br><br><br><br>
      <div>
         <!-- <label>
            lab Name:
         </label> -->
         <div id="autocomplete">
            <input type="text" name="stestname3" id="id-lab-3" class="testname" placeholder="lab Name"
               autocomplete="false">
            <div id="testlist3" class="list" style="z-index: 1"></div>
         </div>


         <input type="number" placeholder="Qty" id="id-qty-3" class="qty" name="sqty3">


         <input id="id-charges-3" class="ipt-charges" name="scharges3"></input>
         <br>
         <br>

      </div>
      </div>
      <span id="" style="padding-left: 430px;">Total=</span>
      <span id="total">0</span>
      <br><br>
      <button type="submit" id="id-btnsub" name="Submit">Submit</button>

   </form>

   <script>

      $(document).ready(function () {


         // for id1 lab name auto seach click and blur event
         $("#id-lab-1").on("keyup", testname1)


         // for id2 lab name auto seach click and blur event
         $("#id-lab-2").on("keyup", testname2);

         // for id3 lab name auto seach click and blur event
         $("#id-lab-3").on("keyup", testname3);

         // when focus on charges class
         $(document).on("blur", "#id-charges-1", charge1)
         $(document).on("blur", "#id-charges-2", charge2)
         $(document).on("blur", "#id-charges-3", charge3);



         // to get data from lab table in charges field on foucus
         function charge1() {
            $("#id-charges-1").html("");

            var lab_name = $("#id-lab-1").val();
            var obj = { slab_name: lab_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/lab_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-1").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-1").val(db[0].CHARGES);

                  }
               }
            });

         }

         function charge2() {
            $("#id-charges-2").html("");

            var lab_name = $("#id-lab-2").val();
            var obj = { slab_name: lab_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/lab_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-2").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-2").val(db[0].CHARGES);

                  }
               }
            });
         }

         function charge3() {
            $("#id-charges-3").html("");

            var lab_name = $("#id-lab-3").val();
            var obj = { slab_name: lab_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/lab_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-3").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-3").val(db[0].CHARGES);

                  }
               }
            });

         }



         function testname1() {
            $("#testlist1").html("");               //empty search list
            var lab_name = $(this).val();


            if (lab_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-search.php?slab_name=' + lab_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#testlist1").fadeIn("fast").append("<ul>" +
                              "<li>" + value.TESTNAME + "</li>" + "</ul>");
                        });
                     }
                  }
               });
               $("#id-lab-1").focusout(("#testlist1").fadeOut);
            }
            else {
               $("#testlist1").fadeOut();
               $("#id-qty-1").html("");
               $("#id-charges-3").html("");

            }
         }

         //  tab to get first li value in field
         $(document).on("blur", "#id-lab-1", function () {

            let c = $("#testlist1 ul:first li:nth-child(1)").text();

            if (c != "") {
               $("#id-lab-1").val(c);
            }

            // $("#medicinelist1 ul:first li:nth-child(1)").text("")
            // var c=$("#medicinelist1 ul:first li:nth-child(1)").val($(this).text());
            // var c=$("#medicinelist1 ul:first li:nth-child(1)").css("color","green");

            console.log(c)
            $("#testlist1").fadeOut();
            charge1()
         });

         //  click to get li value in field
         $(document).on("click", "#testlist1 li", function () {
            $("#id-lab-1").val($(this).text());
            $("#testlist1").fadeOut();
            charge1()
         });

         // fadeOut search list
         $(document).on("blur", "#id-lab-1", function () {
            $("#testlist1").fadeOut();
         });

         // on blur qty having 1
         $("#id-lab-1").change(function () {
            $("#id-qty-1").val(1);
         });

         //idea onfocus chages  qty*chages
         $("#id-charges-1").on("focus", function () {
            var qty = $("#id-qty-1").val()
            console.log(qty)
            const ch = $("#id-charges-1").val()
            console.log(ch)
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-1").val(t)
            }
         })




         function testname2() {
            $("#testlist2").html("");               //empty search list
            var lab_name = $(this).val();


            if (lab_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-search.php?slab_name=' + lab_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#testlist2").fadeIn("fast").append("<ul>" +
                              "<li>" + value.TESTNAME + "</li>" + "</ul>");
                        });
                     }
                  }
               });
               $("#id-lab-2").focusout(("#testlist").fadeOut);
            }
            else {
               $("#testlist2").fadeOut();

            }
         }

         $(document).on("blur", "#id-lab-2", function () {
            let c = $("#testlist2 ul:first li:nth-child(1)").text();

            if (c != "") {
               $("#id-lab-2").val(c);
            }

            console.log(c)
            $("#testlist2").fadeOut();
            charge2()
         });

         $(document).on("click", "#testlist2 li", function () {
            $("#id-lab-2").val($(this).text());
            $("#testlist2").fadeOut();
            charge2()
         });
         $(document).on("blur", "#id-lab-2", function () {
            $("#testlist2").fadeOut();
         });

         $("#id-lab-2").change(function () {
            $("#id-qty-2").val(1)
         });
         $("#id-charges-2").on("focus", function () {
            var qty = $("#id-qty-2").val()
            const ch = $("#id-charges-2").val()
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-2").val(t)
            }
         })


         function testname3() {
            $("#testlist3").html("");               //empty search list
            var lab_name = $(this).val();


            if (lab_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-search.php?slab_name=' + lab_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#testlist3").fadeIn("fast").append("<ul>" +
                              "<li>" + value.TESTNAME + "</li>" + "</ul>");
                        });
                     }
                  }
               });
               $("#id-lab-3").focusout(("#testlist").fadeOut);
            }
            else {
               $("#testlist3").fadeOut();

            }
         }

         $(document).on("blur", "#id-lab-3", function () {
            let c = $("#testlist3 ul:first li:nth-child(1)").text();

            if (c != "") {
               $("#id-lab-3").val(c);
            }

            console.log(c)
            $("#testlist3").fadeOut();
            charge3()
         });

         $(document).on("click", "#testlist3 li", function () {
            $("#id-lab-3").val($(this).text());
            $("#testlist3").fadeOut();
            charge3();
         });
         $(document).on("blur", "#id-lab-3", function () {
            $("#testlist3").fadeOut();

         });

         $("#id-lab-3").change(function () {
            $("#id-qty-3").val(1)
         });
         $("#id-charges-3").on("focus", function () {
            var qty = $("#id-qty-3").val()
            const ch = $("#id-charges-3").val()
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-3").val(t)
            }
         })


         //for total medicne
         $(".ipt-charges").on("blur", function () {
            var ch1 = $("#id-charges-1").val()
            var ch2 = $("#id-charges-2").val()
            var ch3 = $("#id-charges-3").val()
            if (ch1 != "") { ch1 = parseInt(ch1); }
            if (ch2 != "") { ch2 = parseInt(ch2); }
            if (ch3 != "") { ch3 = parseInt(ch3); }
            console.log(ch1)
            console.log(ch2)

            var total1 = ch1 + ch2 + ch3;
            // console.log(total)
            // console.log(typeof(total))
            $("#total").text(total1)
            // console.log($(".total").text())
         });


         $("#id-btnsub").on("click", btnclick())
         // insert data1
         function btnclick() {

            $("#id-btnsub").on("click", function (e) {
               e.preventDefault();


               var arr = $(".testname").serializeArray();

               var objArr = {};

               for (let i = 0; i < arr.length; i++) {
                  if (arr[i].value == '') {
                     // alert("fill all filed");
                     // return false;
                     arr[i].name = "";
                     // delete arr[i];
                     // arr.length = arr.length - 1;
                  } else {
                     objArr[arr[i].name] = arr[i].value;
                  }
               }

               console.log(objArr);
               var testInArr = Object.values(objArr);   //array
               testInArr = JSON.stringify(testInArr)

               console.log(testInArr);
               arrObjtest = { stestarr: testInArr };
               arryObjtestJson = JSON.stringify(arrObjtest)


               //// for qty fild

               var qtyarr = $(".qty").serializeArray();

               var qtyobjArr = {};

               for (let i = 0; i < qtyarr.length; i++) {
                  if (qtyarr[i].value == '') {
                     // alert("fill all filed");
                     // return false;
                     qtyarr[i].name = "";
                     // delete qtyarr[i];
                     // qtyarr.length = qtyarr.length - 1;
                  } else {
                     qtyobjArr[qtyarr[i].name] = qtyarr[i].value;
                  }
               }
               console.log(qtyobjArr);
               var qtyInArr = Object.values(qtyobjArr);
               qtyInArr = JSON.stringify(qtyInArr)

               console.log(qtyInArr);
               arrObjqty = { sqtyarr: qtyInArr };
               arrObjqtyJson = JSON.stringify(arrObjqty);

               //for price


               var pricearr = $(".ipt-charges").serializeArray();

               var priceobjArr = {};
               for (let i = 0; i < pricearr.length; i++) {
                  if (pricearr[i].value == '') {
                     // alert("fill all filed");
                     // return false;
                     pricearr[i].name = "";
                     // delete pricearr[i];
                     // pricearr.length = pricearr.length - 1;
                  } else {
                     priceobjArr[pricearr[i].name] = pricearr[i].value;
                  }
               }
               console.log(priceobjArr);
               var priceInArr = Object.values(priceobjArr);
               priceInArr = JSON.stringify(priceInArr)

               console.log(priceInArr);
               arrObjPrice = { spricearr: priceInArr };
               arrObjPriceJson = JSON.stringify(arrObjPrice)



               //for opdno and date
               var opdno = localStorage.getItem('opdno')  //"107"
               opdno = parseInt(opdno)
               var date1 = localStorage.getItem('date')    //"2022-03-04"

               var obj1 = { sopdno: opdno, sdate: date1 };
               console.log(obj1);

               var finalResult = Object.assign(objArr, qtyobjArr, obj1);
               console.log(finalResult)
               var jsonname2 = JSON.stringify(finalResult)



               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-insert.php',
                  type: "post",
                  data: jsonname2,
                  success: function (data) {
                     if (data.status == true) {
                        alert(data.message)
                        // pageload()
                        console.log("working");
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })




               var finalResultmedicine = Object.assign(arrObjtest, obj1);
               var finalResultmedicineJson = JSON.stringify(finalResultmedicine)
               console.log(finalResultmedicineJson)

               // insert //medicine//,qty,price into homo_bill in array form
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-insert-in-bill-lab-in-array.php',
                  type: "POST",
                  data: finalResultmedicineJson,
                  success: function (data) {
                     console.log(data)
                     if (data.status == true) {
                        alert(data.message)
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })


               var finalResultqty = Object.assign(arrObjqty, obj1);
               var finalResultqtyJson = JSON.stringify(finalResultqty)
               console.log(finalResultqtyJson)

               // insert medicine,//qty//,price into homo_bill in array form
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-insert-in-bill-qty-in-array.php',
                  type: "POST",
                  data: finalResultqtyJson,
                  success: function (data) {
                     console.log(data)
                     if (data.status == true) {
                        alert(data.message)
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })


               var finalResultPrice = Object.assign(arrObjPrice, obj1);
               var finalResultPriceJson = JSON.stringify(finalResultPrice)
               finalResultPriceJson = JSON.stringify(finalResultPrice)
               console.log(finalResultPriceJson)


               // insert medicine,qty,//price// into homo_bill in array form
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-insert-in-bill-price-in-array.php',
                  type: "POST",
                  data: finalResultPriceJson,
                  success: function (data) {
                     console.log(data)
                     if (data.status != false) {
                        alert(data.message)
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })


               var totalinsert = $("#total").text();
               totalinsert = parseInt(totalinsert)
               
               var objtotal = { stotal: totalinsert };
               console.log(obj1);
               var finaltotal = Object.assign(objtotal, obj1);
               finaltotal = JSON.stringify(finaltotal)

               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/lab_api/api-insert-total-lab-price.php',
                  type: "POST",
                  data: finaltotal,
                  success: function (data) {
                     console.log(data)
                     if (data.status != false) {
                        alert(data.message)
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })




               location.href = 'http://localhost:3000/html/homoeopathic/patient_process.html';

            })

         }


      });


   </script>

</body>

</html>


<!-- test_qty
test_charges
test_total -->
