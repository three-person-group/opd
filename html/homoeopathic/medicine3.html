<!DOCTYPE html>

<html>

<head>
   <h2>medicine</h2>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <link rel="stylesheet" href="medicine.css">

   <style>
      #autocomplete {
         width: 250px;
         float: left;
         position: relative;
         
      }

      .medicinename {
         width: 100%;
         height: 36px;
         font-size: 18px;
         padding: 3px 10px;
         border-radius: 4px;
         /* border: 1px solid #e58940; */
         outline: 0;
         box-sizing: border-box;
         /*may be im z-index: 1; */
      }

      .list {
         width: 100%;
         position: absolute;
         border: 1px solid #4d6e87;
         display: none;
         background-color: #4d6e87;
         
      }

      .list ul {
         list-style: none;
         background: #fff;
         margin: 0;
         padding: 0;
         text-align: left;

      }

      .list ul li {
         padding: 2px 10px;
         cursor: pointer;
      }

      .list ul li:hover {
         background: #d0e4f4;
      }
   </style>

</head>

<body>

   <form method="post" action="">

      <button href="" name="add_medicine">Add</button>
      <br>

      <div>
         <medicineel>
            <!-- Medicine Name: -->
         </medicineel>
         <div id="autocomplete">
            <input type="text" id="id-medicine-1" class="medicinename" name="smedicinename1" placeholder="medicine Name"
               autocomplete="false" >
            <div id="medicinelist1" class="list" style="z-index: 1;"></div>
         </div>

         <input type="number" placeholder="Qty" id="id-qty-1" class="qty" name="sqty1">
         
         <input id="id-charges-1" class="ipt-charges" placeholder="Price" name="scharges1"></input>
         <br>
         <br>
      </div>

      <!-- <br><br><br><br>
      <br><br><br><br> -->
      <div>
         <medicineel>
            <!-- Medicine Name: -->
         </medicineel>
         <div id="autocomplete">
            <input type="text" id="id-medicine-2" class="medicinename" name="smedicinename2" placeholder="medicine Name"
               autocomplete="false" style=" z-index: 2;">
            <div id="medicinelist2" class="list" style="z-index: 1"></div>
         </div>


         <input type="number" placeholder="Qty" id="id-qty-2" class="qty" name="sqty2">

         <input id="id-charges-2" class="ipt-charges" placeholder="Price" name="scharges2"></input>
         <br>
         <br>

      </div>
      <!-- <br><br><br><br><br><br> -->
      <div>
         <medicineel>
            <!-- Medicine Name: -->
         </medicineel>
         <div id="autocomplete">
            <input type="text" id="id-medicine-3" class="medicinename" name="smedicinename3" placeholder="medicine Name"
               autocomplete="false" >
            <div id="medicinelist3" class="list" style="z-index: 1"></div>
         </div>


         <input type="number" placeholder="Qty" id="id-qty-3" class="qty" name="sqty3">

         <input id="id-charges-3" class="ipt-charges" placeholder="Price" name="scharges3"></input>
         <br>
         <br>

      </div>
      <span id="" style="padding-left: 430px;">Total=</span>
      <span id="total">0</span>
      <br><br>

      <button type="submit" id="id-btnsub" name="Submit">Submit</button>

   </form>

   <script>

      $(document).ready(function () {


         // for id1 medicine name auto seach click and blur event
         $("#id-medicine-1").on("keyup", medicinename1)


         // for id2 medicine name auto seach click and blur event
         $("#id-medicine-2").on("keyup", medicinename2);

         // for id3 medicine name auto seach click and blur event
         $("#id-medicine-3").on("keyup", medicinename3);


         // when focus on charges class
         $(document).on("blur", "#id-medicine-1", charge1)
         $(document).on("blur", "#id-medicine-2", charge2)
         $(document).on("blur", "#id-medicine-3", charge3);



         // to get data from medicine table in charges field on foucus
         function charge1() {
            $("#id-charges-1").html("");

            var medicine_name = $("#id-medicine-1").val();
            var obj = { smedicine_name: medicine_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-1").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-1").val(db[0].CHARGES);
                  }
               }
            });

         }

         function charge2() {
            $("#id-charges-2").html("");

            var medicine_name = $("#id-medicine-2").val();
            var obj = { smedicine_name: medicine_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-2").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-2").val(db[0].CHARGES);

                  }
               }
            });
         }

         function charge3() {
            $("#id-charges-3").html("");

            var medicine_name = $("#id-medicine-3").val();
            var obj = { smedicine_name: medicine_name };
            var jsonname = JSON.stringify(obj)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-fetch-one.php',
               type: "POST",
               data: jsonname,
               success: function (data) {

                  var db = (JSON.parse(data));
                  // console.log(db);


                  if (data.status == false) {
                     $("#id-charges-3").val("Cant Fetch");
                  }
                  else {
                     $("#id-charges-3").val(db[0].CHARGES);

                  }
               }
            });

         }


         // search medicine name from table
         function medicinename1() {
            $("#medicinelist1").html("");               //empty search list
            var medicine_name = $(this).val();


            if (medicine_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-search.php?smedicine_name=' + medicine_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#medicinelist1").fadeIn("fast").append("<ul>" +
                              "<li>" + value.PERTICULAR + "</li>" + "</ul>");
                        });
                     }
                  }
               });

               $("#id-medicine-1").focusout(("#medicinelist1").fadeOut);
               // var d=$("#id-medicine-1").focusout(("#medicinelist li"));
               // console.log(d,d.val)
            }
            else {

               $("#medicinelist1").fadeOut();
               $("#id-qty-1").html("");
               $("#id-charges-3").html("");
            }
         }
         //  tab to get first li value in field
         $(document).on("blur", "#id-medicine-1", function () {

            let c = $("#medicinelist1 ul:first li:nth-child(1)").text();

            if (c != "") {
               $("#id-medicine-1").val(c);
            }

            // $("#medicinelist1 ul:first li:nth-child(1)").text("")
            // var c=$("#medicinelist1 ul:first li:nth-child(1)").val($(this).text());
            // var c=$("#medicinelist1 ul:first li:nth-child(1)").css("color","green");
            
            console.log(c)
            $("#medicinelist1").fadeOut();
            charge1()
         });

         //  click to get li value in field
         $(document).on("click", "#medicinelist1 li", function () {
            $("#id-medicine-1").val($(this).text());
            $("#medicinelist1").fadeOut();
            charge1()
         });
         // fadeOut search list
         $(document).on("blur", "#id-medicine-1", function () {
            $("#medicinelist1").fadeOut();
         });
         // on blur qty having 1
         $("#id-medicine-1").change(function () {
            $("#id-qty-1").val(1)
         });
         //idea onfocus chages  qty*chages
         $("#id-charges-1").on("focus", function () {
            var qty = $("#id-qty-1").val()
            console.log(qty)
            const ch = $("#id-charges-1").val()
            console.log(ch)
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-1").val(t)
            }
         })



         function medicinename2() {
            $("#medicinelist2").html("");               //empty search list
            var medicine_name = $(this).val();


            if (medicine_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-search.php?smedicine_name=' + medicine_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#medicinelist2").fadeIn("fast").append("<ul>" +
                              "<li>" + value.PERTICULAR + "</li>" + "</ul>");
                        });
                     }
                  }
               });
               $("#id-medicine-2").focusout(("#medicinelist2").fadeOut);
            }
            else {
               $("#medicinelist2").fadeOut();

            }
         }
         $(document).on("blur", "#id-medicine-2", function () {
            let c = $("#medicinelist2 ul:first li:nth-child(1)").text();
            
            if (c != "") {
            $("#id-medicine-2").val(c);
            }

            console.log(c)
            $("#medicinelist2").fadeOut();
            charge2()
         });

         $(document).on("click", "#medicinelist2 li", function () {
            $("#id-medicine-2").val($(this).text());
            $("#medicinelist2").fadeOut();
            charge2()
         });
         $(document).on("blur", "#id-medicine-2", function () {
            $("#medicinelist2").fadeOut();
         });
         $("#id-medicine-2").change(function () {
            $("#id-qty-2").val(1)
         });
         $("#id-charges-2").on("focus", function () {
            var qty = $("#id-qty-2").val()
            const ch = $("#id-charges-2").val()
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-2").val(t)
            }
         })


         function medicinename3() {
            $("#medicinelist3").html("");               //empty search list
            var medicine_name = $(this).val();


            if (medicine_name != "") {
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-search.php?smedicine_name=' + medicine_name,
                  type: "GET",
                  dataType: "json",
                  success: function (data) {
                     console.log(data)

                     if (data.status == false) {
                        $("#table-id").fadeIn("fast").append("<ul>" +
                           "<li>" + "NOT FOUND" + "</li>" + "</ul>")
                     }
                     else {

                        //dropdown  type search
                        $.each(data, function (key, value) {
                           $("#medicinelist3").fadeIn("fast").append("<ul>" +
                              "<li>" + value.PERTICULAR + "</li>" + "</ul>");
                        });
                     }
                  }
               });
               $("#id-medicine-3").focusout(("#medicinelist").fadeOut);
            }
            else {
               $("#medicinelist3").fadeOut();

            }
         }
         $(document).on("blur", "#id-medicine-3", function () {
            let c = $("#medicinelist3 ul:first li:nth-child(1)").text();
            
            if (c != "") {
            $("#id-medicine-3").val(c);
            }
            console.log(c)
            $("#medicinelist3").fadeOut();
            charge3()
         });
         $(document).on("click", "#medicinelist3 li", function () {
            $("#id-medicine-3").val($(this).text());
            $("#medicinelist3").fadeOut();
            charge3();
         });
         $(document).on("blur", "#id-medicine-3", function () {
            $("#medicinelist3").fadeOut();

         });
         $("#id-medicine-3").change(function () {
            $("#id-qty-3").val(1)
         });
         $("#id-charges-3").on("focus", function () {
            var qty = $("#id-qty-3").val()
            console.log(qty)
            const ch = $("#id-charges-3").val()
            console.log(ch)
            if (qty != "") {
               var t = qty * ch;
               $("#id-charges-3").val(t)
            }
         })

         //for total medicne
         $(".ipt-charges").on("blur", function () {
            var ch1 = $("#id-charges-1").val()
            var ch2 = $("#id-charges-2").val()
            var ch3 = $("#id-charges-3").val()
            if (ch1 != "") { ch1 = parseInt(ch1); }
            if (ch2 != "") { ch2 = parseInt(ch2); }
            if (ch3 != "") { ch3 = parseInt(ch3); }
            console.log(ch1)
            console.log(ch2)

            var total1 = ch1 + ch2 + ch3;
            // console.log(total)
            // console.log(typeof(total))
            $("#total").text(total1)
            // console.log($(".total").text())
         });


         // $("#id-btnsub").on("click", btnclick())
         // // insert data1
         // function btnclick() {

         $("#id-btnsub").on("click", function (e) {
            e.preventDefault();

            // for medicine fild

            //serialize filed into Array to send data to api
            var arr = $(".medicinename").serializeArray();

            var objArr = {};

            for (let i = 0; i < arr.length; i++) {
               if (arr[i].value == '') {
                  // alert("fill all filed");
                  // return false;
                  arr[i].name = "";
                  // delete arr[i];
                  // arr.length = arr.length - 1;
               } else {
                  objArr[arr[i].name] = arr[i].value;   //obj 
               }
            }
            console.log(objArr);
            var medicineInArr = Object.values(objArr);   //array
            medicineInArr = JSON.stringify(medicineInArr)

            console.log(medicineInArr);
            arrObjmedicine = { smedicinearr: medicineInArr };
            arryObjmedicineJson = JSON.stringify(arrObjmedicine)


            //// for qty fild

            var qtyarr = $(".qty").serializeArray();

            var qtyobjArr = {};

            for (let i = 0; i < qtyarr.length; i++) {
               if (qtyarr[i].value == '') {
                  // alert("fill all filed");
                  // return false;
                  qtyarr[i].name = "";
                  // delete qtyarr[i];
                  // qtyarr.length = qtyarr.length - 1;
               } else {
                  qtyobjArr[qtyarr[i].name] = qtyarr[i].value;
               }
            }
            console.log(qtyobjArr);
            var qtyInArr = Object.values(qtyobjArr);
            qtyInArr = JSON.stringify(qtyInArr)

            console.log(qtyInArr);
            arrObjqty = { sqtyarr: qtyInArr };
            arrObjqtyJson = JSON.stringify(arrObjqty)

            //for price


            var pricearr = $(".ipt-charges").serializeArray();

            var priceobjArr = {};
            for (let i = 0; i < pricearr.length; i++) {
               if (pricearr[i].value == '') {
                  // alert("fill all filed");
                  // return false;
                  pricearr[i].name = "";
                  // delete pricearr[i];
                  // pricearr.length = pricearr.length - 1;
               } else {
                  priceobjArr[pricearr[i].name] = pricearr[i].value;
               }
            }
            console.log(priceobjArr);
            var priceInArr = Object.values(priceobjArr);
            priceInArr = JSON.stringify(priceInArr)

            console.log(priceInArr);
            arrObjPrice = { spricearr: priceInArr };
            arrObjPriceJson = JSON.stringify(arrObjPrice)



            //for opdno and date
            var opdno = localStorage.getItem('opdno')  //"107"
            opdno = parseInt(opdno)
            var date1 = localStorage.getItem('date')    //"2022-03-04"

            var obj1 = { sopdno: opdno, sdate: date1 };
            console.log(obj1);

            var finalResult = Object.assign(objArr, qtyobjArr, obj1);
            console.log(finalResult)
            var jsonname2 = JSON.stringify(finalResult)


            // insert qty into medicine name in anventory
            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-insert.php',
               type: "POST",
               data: jsonname2,
               success: function (data) {
                  console.log(data)
                  if (data.status == true) {
                     alert(data.message)
                  }
                  else {
                     console.log("notworking");
                     alert(data.message);

                  }
               }
            })


            var finalResultmedicine = Object.assign(arrObjmedicine, obj1);
            var finalResultmedicineJson = JSON.stringify(finalResultmedicine)
            console.log(finalResultmedicineJson)

            // insert //medicine//,qty,price into homo_bill in array form
            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-insert-in-bill-medicine-in-array.php',
               type: "POST",
               data: finalResultmedicineJson,
               success: function (data) {
                  console.log(data)
                  if (data.status == true) {
                     alert(data.message)
                  }
                  else {
                     console.log("notworking");
                     alert(data.message);

                  }
               }
            })


            var finalResultqty = Object.assign(arrObjqty, obj1);
            var finalResultqtyJson = JSON.stringify(finalResultqty)
            console.log(finalResultqtyJson)

            // insert medicine,//qty//,price into homo_bill in array form
            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-insert-in-bill-qty-in-array.php',
               type: "POST",
               data: finalResultqtyJson,
               success: function (data) {
                  console.log(data)
                  if (data.status == true) {
                     alert(data.message)
                  }
                  else {
                     console.log("notworking");
                     alert(data.message);

                  }
               }
            })


            var finalResultPrice = Object.assign(arrObjPrice, obj1);
            var finalResultPriceJson = JSON.stringify(finalResultPrice)
            finalResultPriceJson = JSON.stringify(finalResultPrice)
            console.log(finalResultPriceJson)


            // insert medicine,qty,//price// into homo_bill in array form
            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-insert-in-bill-price-in-array.php',
               type: "POST",
               data: finalResultPriceJson,
               success: function (data) {
                  console.log(data)
                  if (data.status == true) {
                     alert(data.message)
                  }
                  else {
                     console.log("notworking");
                     alert(data.message);

                  }
               }
            })


            var totalinsert = $("#total").text();
            var objtotal = { stotal: totalinsert };
            console.log(obj1);
            var finaltotal = Object.assign(objtotal, obj1);
            finaltotal = JSON.stringify(finaltotal)

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/medicine_api/api-insert-total-medicine-price.php',
               type: "POST",
               data: finaltotal,
               success: function (data) {
                  console.log(data)
                  if (data.status == true) {
                     alert(data.message)
                  }
                  else {
                     console.log("notworking");
                     alert(data.message);

                  }
               }
            })




            location.href = 'http://localhost:3000/html/homoeopathic/patient_process.html';


            
         })

         // }

      });
   </script>

</body>

</html>


<!-- MAJOR DRESSING(DEPENDS ON DRESSING) rename in homo table due to spacing
STICHES(1ST STITCH) also OTHER STITCH 	1 WEEK DISPENSARY CHARGES 	2 WEEK DISPENSARY CHARGES -->