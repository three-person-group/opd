<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Bill</title>
   <link rel="stylesheet" href="medicine.css">

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

   <style>
      table,
      td,
      tr {
         border: 4px solid black;
      }
   </style>
</head>

<body>

   date:
   <span for="" id="date"></span>
   Opdno:
   <span for="" id="opdno"></span>
   Name:
   <span for="" id="name">name</span>


   <table id="id-table">
      <tr>
         <td>
            PERTICULAR
         </td>
         <td>
            Qty
         </td>
         <td>
            price
         </td>
      </tr>


   </table>





   total <span id="id-total"></span>


   <script>
      $(document).ready(function () {

         //for opdno and date
         var opdno = localStorage.getItem('opdno')  //"107"
         opdno = parseInt(opdno)
         var date1 = localStorage.getItem('date')    //"2022-03-04"
         var name1 = localStorage.getItem('name')    //"2022-03-04"


         $("#date").text(date1);
         $("#opdno").text(opdno);
         $("#name").text(name1);


         var obj1 = { sopdno: opdno, sdate: date1 };
         console.log(obj1);
         var JSONobj1 = JSON.stringify(obj1);




         //fetch reg data

         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/bill_api/api-consulting-paid-or-not.php',
            type: "post",
            dataType: "json",
            data: JSONobj1,
            success: function (data) {
               console.log(data);
               // var db = (JSON.parse(data));
               // console.log(db);


               if (data.status == 'false') {
                  // $("#id-table").append("<tr>" +
                  //    "<td>" + 'REGISTRATION CHARGE' + "</td>" +
                  //    "<td>" + '' + "</td>" +
                  //    "<td>" + "0" + "</td>" +
                  //    "</tr>");
               }
               else {
                  // $("#id-table").html("");
                  console.log(data);
                  $.each(data, function (key, value) {

                     $("#id-table").append("<tr>" +
                        "<td>" + 'REGISTRATION CHARGE' + "</td>" +
                        "<td>" + '' + "</td>" +
                        "<td>" + value.REG_CHARGE + "</td>" +
                        "</tr>");
                  });


               }
            }

         });



         //for madicine list in html table
         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/bill_api/api-fetch-medicine-list.php',
            type: "post",
            dataType: "json",
            data: JSONobj1,
            success: function (data) {
               console.log(data);
               // var db = (JSON.parse(data));
               // console.log(db);


               if (data.status == false) {
                  // $("#id-registrationCharges").val(20);
               }
               else {
                  // console.log(data);
                  $.each(data, function (key, value) {

                     var jsonMedicine = JSON.parse(value.medicine_name)
                     var jsonQty = JSON.parse(value.medicine_qty)
                     var jsonCharges = JSON.parse(value.medicine_charges)


                     var arrayOne = jsonMedicine;
                     var arrayTwo = jsonQty;
                     var arrayThree = jsonCharges;

                     var maxSize = Math.max(arrayOne.length, arrayTwo.length, arrayThree.length);

                     for (let i = 0; i < maxSize; i++) {
                        let row = $('<tr>');
                        row.append($('<td>').html(arrayOne[i]));
                        row.append($('<td>').html(arrayTwo[i]));
                        row.append($('<td>').html(arrayThree[i]));
                        $('#id-table').append(row);
                     }
                  });

               }
            }

         });

         //for lab list in html table

         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/bill_api/api-fetch-lab-list.php',
            type: "post",
            dataType: "json",
            data: JSONobj1,
            success: function (data) {
               console.log(data);
               // var db = (JSON.parse(data));
               // console.log(db);


               if (data.status == false) {
                  // $("#id-registrationCharges").val(20);
               }
               else {
                  // console.log(data);
                  $.each(data, function (key, value) {

                     var jsonMedicine = JSON.parse(value.test_name)
                     var jsonQty = JSON.parse(value.test_qty)
                     var jsonCharges = JSON.parse(value.test_charges)


                     var arrayOne = jsonMedicine;
                     var arrayTwo = jsonQty;
                     var arrayThree = jsonCharges;

                     var maxSize = Math.max(arrayOne.length, arrayTwo.length, arrayThree.length);

                     for (let i = 0; i < maxSize; i++) {
                        let row = $('<tr>');
                        row.append($('<td>').html(arrayOne[i]));
                        row.append($('<td>').html(arrayTwo[i]));
                        row.append($('<td>').html(arrayThree[i]));
                        $('#id-table').append(row);
                     }
                  });

               }
            }

         });

         //for other list in html table

         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/bill_api/api-fetch-other-list.php',
            type: "post",
            dataType: "json",
            data: JSONobj1,
            success: function (data) {
               console.log(data);
               // var db = (JSON.parse(data));
               // console.log(db);


               if (data.status == false) {
                  // $("#id-registrationCharges").val(20);
               }
               else {
                  // console.log(data);
                  $.each(data, function (key, value) {

                     var jsonMedicine = JSON.parse(value.other_name)
                     var jsonQty = JSON.parse(value.other_qty)
                     var jsonCharges = JSON.parse(value.other_charges)


                     var arrayOne = jsonMedicine;
                     var arrayTwo = jsonQty;
                     var arrayThree = jsonCharges;

                     var maxSize = Math.max(arrayOne.length, arrayTwo.length, arrayThree.length);

                     for (let i = 0; i < maxSize; i++) {
                        let row = $('<tr>');
                        row.append($('<td>').html(arrayOne[i]));
                        row.append($('<td>').html(arrayTwo[i]));
                        row.append($('<td>').html(arrayThree[i]));
                        $('#id-table').append(row);
                     }
                  });

               }
            }

         });

         // opdno = localStorage.getItem('opdno')  //"107"
         // opdno = parseInt(opdno)
         // date1 = localStorage.getItem('date')    //"2022-03-04"
         // name1 = localStorage.getItem('name')

         // obj = { sopdno: opdno, sdate: date1 };
         // console.log(obj);
         // var obj2Json2 = JSON.stringify(obj);


         //for total get from sum of medicine total and lab
         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/bill_api/api-get-total.php',
            type: "POST",
            data: JSONobj1,
            success: function (data) {
               console.log(data)
               if (data.status == false) {


               }
               else {
                  console.log(data);
                  var db = JSON.parse(data)

                  var reg_charge = parseInt(db[0].reg_charge);
                  var medicine_total = parseInt(db[0].medicine_total);
                  var test_total = parseInt(db[0].test_total);
                  var other_total = parseInt(db[0].other_total);

                  console.log(reg_charge + medicine_total + test_total + other_total);

                  $("#id-total").text("abc");


                  let totalOfAll = reg_charge + medicine_total + test_total + other_total;

                  $("#id-total").text(totalOfAll);
                  pushTotal();
               }


            }
         });


         function pushTotal() {

            var totalOfAllCharges = $("#id-total").text();

            var total = { stotal: totalOfAllCharges };
            console.log(obj1);

            var finalResultObj = Object.assign(total, obj1);
            var finalResultmedicineJson = JSON.stringify(finalResultObj)
            console.log(finalResultmedicineJson)

            //inserting  total into bill data base
            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/bill_api/api-push-total.php',
               type: "POST",
               data: finalResultmedicineJson,
               success: function (data) {
                  console.log(data)
                  lert("data.message");

                  if (data.status == true) {
                     alert("data.message");
                  }
                  else {
                     alert("data.message");

                  }


               }
            });

         }


      });

   </script>
</body>

</html>