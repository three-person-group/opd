<!doctype html>
<html lang="en">

<head>
   <!-- Required meta tags -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <!-- Bootstrap CSS -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
   <!-- <link rel="stylesheet" href="opdreg.css"> -->
   <title>Hello, world!</title>
   <style>
      /* td,
        tr,
        table {
            border: solid black 10px;
        }

        label {

            margin-inline-start: 26pc;
        }

        input {

            margin-inline-start: 10px;
            padding-left: 20px;
        } */
      body {
         background-color: #876dee;
      }
   </style>
   <link rel="stylesheet" href="opdreg.css">


</head>

<body>


   <!-- Optional JavaScript; choose one of the two! -->

   <!-- Option 1: Bootstrap Bundle with Popper -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>

   <!-- Option 2: Separate Popper and Bootstrap JS -->
   <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
-->

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

   <h2>OPD
      REGISTRATION</h2>

   <!-- <form method="post" id="form-body" action=""> -->
   <section class="signup">

      <div class="container">
         <form method="" id="form-body" class="signup-form">
            <div class="form-row">
               <div class="form-group">
                  <label for="Date">Date</label>
                  <input type="text" class="form-input" name="sdate" id="id-date" required>

               </div>
               <div class="form-group">
                  <label for="no">OPD NO</label>
                  <input type="number" id="id-opdid" class="form-input" name="sopdno" required>
               </div>
            </div>
            <div class="form-row">
               <div class="form-group form-icon">
                  <label for="name">Name</label>
                  <input type="text" class="form-input" name="spname" id="first_name" placeholder="Enter Your Name"
                     required>
               </div>
               <div class="form-group">
                  <label for="no">Age</label>
                  <input type="number" class="form-input" name="sage" placeholder="Enter Your Age" required>
               </div>
            </div>

            <div class="form-row">
               <div class="form-radio">
                  <label for="gender">Gender</label>
                  <div class="form-flex">
                     <input type="radio" name="sgender" value="male" id="male" checked="checked"
                        onclick="myFunction(this.value)">
                     <label for="male" style="padding:20px;">Male</label>

                     <input type="radio" name="sgender" value="female" id="female" onclick="myFunction(this.value)" />
                     <label for="female" style="padding:20px;">Female</label>
                  </div>
               </div>
               <div class="form-group">
                  <label for="City">City</label>
                  <input type="text" class="form-input" name="scity" placeholder="Enter City " required>
               </div>
            </div>
            <div class="form-group">
               <label for="Address">Address</label>
               <input type="textarea" class="form-input" name="saddress" id="phone_number" placeholder="Enter Address"
                  required>
            </div>

            <div class="form-row">
               <div class="form-group">
                  <label for="no">Contact NO</label>
                  <input type="number" class="form-input" name="scontact_no" id="phone_number"
                     placeholder="phone number" pattern="^\d{10}$" required>
               </div>

               <div class="form-group">
                  <label for="Email">Email</label>
                  <input type="text" class="form-input" name="semail" id="email" placeholder="Enter Email Addres">
               </div>

            </div>

            <div class="form-group">
               <input type="submit" name="submit" id="id-btnsub" class="form-submit" value="Submit">
            </div>

         </form>
      </div>
   </section>

   <!-- </form> -->






   <!-- <button type="submit" id="id-btnsub" name="submit">Submit</button> -->




   <script>

      function myFunction(browser) {
         var gender = browser;
         console.log(gender);
      }

      $(document).ready(function () {

         const input1 = document.querySelector("#first_name");

         // use the focus method
         input1.focus();
         //DATE CREATION
         var today = new Date();
         var dd = String(today.getDate()).padStart(2, '0');
         var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
         var yyyy = today.getFullYear();

         today = yyyy + '-' + mm + '-' + dd;
         // document.write(today);
         $("#id-date").val(today)



         // //fetch reg chg data

         // $("#id-opdid").html("");

         // $.ajax({
         //    url: 'http://localhost:3000/html/homoeopathic/opd_api/api-fetch-one.php',
         //    type: "GET",
         //    success: function (data) {
         //       console.log(data);
         //       var db = (JSON.parse(data));
         //       console.log(db);


         //       if (data.status == false) {
         //          $("#id-registrationCharges").val(20);
         //       }
         //       else {
         //          $("#id-registrationCharges").val(db[0].CHARGES);

         //       }
         //    }


         // });




         //fetch opdno data

         $("#id-opdid").html("");

         $.ajax({
            url: 'http://localhost:3000/html/homoeopathic/opd_api/api-to-get-opdno.php',
            type: "GET",
            success: function (data) {
               console.log(data);
               var db = (JSON.parse(data));
               console.log(db);

               console.log(data.status)
               if (db.status == "false") {
                  // $("#id-registrationCharges").val(20);
                  $("#id-opdid").val(1);
               }
               else {
                  var opdno = db[0].opdno;
                  console.log(typeof (opdno))
                  opdno = parseInt(opdno) + 1;
                  $("#id-opdid").val(opdno);

               }
            }


         });


         // on click on sub button
         // $("#id-btnsub").on("click", btnclick())

         // insert data

         $(document).on("click", "#id-btnsub", function (e) {
            e.preventDefault();

            var opdno1 = $("#id-opdid").val();
            var ObjOpdno = { sopdno: opdno1 };
            var ObjOpdnoJson = JSON.stringify(ObjOpdno);

            $.ajax({
               url: 'http://localhost:3000/html/homoeopathic/opd_api/api-check-opdno-existing-or-not.php',
               type: "post",
               data: ObjOpdnoJson,
               success: function (data) {
                  var db = JSON.parse(data);
                  if (db.status == 'false') {

                     console.log("not existes");
                     // alert("not existes");

                     //
                     btnclick();

                  }
                  else {

                     alert("Already opdno existst")
                     // pageload()
                     console.log("Already opdno existst");
                  }
               }
            })

            function btnclick() {

               var arr = $("#form-body").serializeArray();

               var objArr = {};

               for (let i = 0; i < arr.length; i++) {
                  if (arr[i].value == "") {
                     alert("fill all filed");
                     return false;
                  }
                  objArr[arr[i].name] = arr[i].value;
               }

               var jsonInsertData = JSON.stringify(objArr);  //send to existing_patient ,patient_register and bill
               console.log(jsonInsertData);

               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/opd_api/api-insert-in-existing-papatient.php',
                  type: "post",
                  data: jsonInsertData,
                  success: function (data) {
                     if (data.status == true) {
                        alert(data.message)
                        // pageload()
                        console.log("working");
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })

               //for patient_register
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/opd_api/api-insert-in-papatient_reg.php',
                  type: "post",
                  data: jsonInsertData,
                  success: function (data) {
                     if (data.status == true) {
                        alert(data.message)
                        // pageload()
                        console.log("working");
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })

               //for homoeopathic_bill
               $.ajax({
                  url: 'http://localhost:3000/html/homoeopathic/opd_api/api-insert-in-bill.php',
                  type: "post",
                  data: jsonInsertData,
                  success: function (data) {
                     if (data.status == true) {
                        alert(data.message)
                        // pageload()
                        console.log("working");
                     }
                     else {
                        console.log("notworking");
                        alert(data.message);

                     }
                  }
               })


               location.href = 'http://localhost:3000/html/homoeopathic/patient_process.html'
               //click event
            }



         });
         //function end





         //ready end
      });



   </script>

</body>

</html>